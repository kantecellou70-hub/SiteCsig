// Fonctions globales pour éditer et supprimer
function editPartner(partnerId) {
    console.log('editPartner appelé avec ID:', partnerId);
    window.location.href = `{% url "content_management:event_manage_organizers" event.pk %}`.replace('organizers/', `organizers/${partnerId}/edit/`);
}

function deletePartner(partnerId) {
    console.log('deletePartner appelé avec ID:', partnerId);
    
    // Vérification simple
    if (!partnerId) {
        console.error('ID partenaire manquant');
        return;
    }
    
    // Stocker l'ID du partenaire à supprimer
    window.partnerToDelete = partnerId;
    
    // Afficher le modal Bootstrap de confirmation
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
    deleteModal.show();
}

// Gérer la confirmation de suppression
document.addEventListener('DOMContentLoaded', function() {
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', function() {
            const partnerId = window.partnerToDelete;
            if (partnerId) {
                console.log('Confirmation de suppression pour ID:', partnerId);
                performDelete(partnerId);
                
                // Fermer le modal
                const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
                if (deleteModal) {
                    deleteModal.hide();
                }
            }
        });
    }
});

function performDelete(partnerId) {
    console.log('Exécution de la suppression pour ID:', partnerId);
    
    // Afficher un indicateur de chargement
    showNotification('Suppression en cours...', 'info');
    
    fetch(`{% url "content_management:event_manage_organizers" event.pk %}`.replace('organizers/', `organizers/${partnerId}/delete/`), {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        if (response.ok) {
            showNotification('Organisateur supprimé avec succès !', 'success');
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        } else {
            showNotification('Erreur lors de la suppression', 'error');
        }
    })
    .catch(error => {
        showNotification('Erreur lors de la suppression: ' + error.message, 'error');
    });
}
